# **oama** - OAuth credential Manager

> [NOTE!]
> `oama` is the successor of `mailctl`; for rationale and details, see
> the [discussion](https://github.com/pdobsan/oama/discussions/26)

The Oauth2 credentials are kept in the
[**Gnome keyring**](https://wiki.gnome.org/Projects/GnomeKeyring/) or
in [GNU PG](https://www.gnupg.org/) **encrypted files**.

Many IMAP/SMTP clients, like [msmtp](https://marlam.de/msmtp/),
[fdm](https://github.com/nicm/fdm),
[isync](http://isync.sourceforge.net/),
[neomutt](https://github.com/neomutt/neomutt) or
[mutt](http://www.mutt.org/) can use OAuth2 access tokens but lack the
ability to renew and/or authorize OAuth2 credentials. The purpose of
`oama` is to provide these missing capabilities by acting as a kind of
smart password manager. In particular, access token renewal happens
automatically in the background transparent to the user.

## Installation

`oama` has not been officially released yet but it can be built from the
recent main branch. Pre-compiled binaries will come (back) with the first
release soon. 

### Building from sources

To build `oama` from source you need a Haskell development environment,
with `ghc 9.4.8` or higher. Either your platform's package system can provide
this or you can use [ghcup](https://www.haskell.org/ghcup/). Once you have
the `ghc` Haskell compiler and `cabal` etc. installed, follow the steps
below:

Clone this repository and invoke `cabal`:

    git clone https://github.com/pdobsan/oama
    cd oama
    cabal update
    cabal install --install-method=copy

That installs `oama` into the `~/.cabal/bin/` directory.

## Configuration

`oama` version 0.3 or newer has a much simplified configuration system
and comes also with other **breaking changes**. The only information you need
to provide are `client_id` and `client_secret` and select the method of
storing the oauth credentials. 

If you used an earlier version of oama or `mailctl` you need to start
from scratch. First uninstall `oama` or `mailctl` then remove all config and
data files:

    rm -fr ~/.local/var/{mailctl,oama}
    rm -fr ~/.config/{mailct,oama}

If you used the gnome keyring the you might also want to remove the old
credentials from your keyring.

Then run `oama` without any arguments it will create the necessary initial
configuration what you can edit. From that point follow the instructions
in the Usage section below.

## Usage

Before `oama` is fully operational you need to create the necessary
configuration files. See details in [Configuration](#configuration).

Invoking `oama` without any arguments print a help message listing the
available commands. More detailed help for individual commands can also be
generated by appending `-h` after the command. Shell completion for
`bash`, `zsh` and `fish` shells are provided.

After configuration the very first command you must run is `authorize`. That
is an interactive process involving a browser since during it you need to
login and authorize access to your email account. `oama` will lead you
through this process.

### Authorization for Corporate/Organizational/Institutional accounts

Corporation/Organization/Institution accounts might be treated differently
by the service provider. In such cases, not passing a login hint might be
useful, see below.

#### Google Organizational Account

Invoke `oama` with no login hint:

    oama authorize google <you@company.email> --nohint

#### Microsoft Organizational Account

Invoke `oama` using your proper organizational email:

    oama authorize microsoft <you@company.email>

Then visit the `http://localhost:8080/start` page to perform the steps
below:

 - Click "Sign in with another account"
 - Click "Sign-in options"
 - Click "Sign in to an organization"
 - Put in the correct domain name which matches your organization address above
 - Log in with your credentials at the organization.

## Logging

All transactions and exceptions are logged to `syslog`. If your OS using
`systemd` you can inspect the log with a command like below:

    journalctl --identifier fdm --identifier oama --identifier msmtp -e

## Issues

Please, report any problems, questions, suggestions regarding `oama` by
opening an issue or by starting a discussion here. For bug reports attach the
error messages if any and the complete output of the `oama printenv` command.


## License

`oama` is released under the 3-Clause BSD License, see the file
[LICENSE](LICENSE).

